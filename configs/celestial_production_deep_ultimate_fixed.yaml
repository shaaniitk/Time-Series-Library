# ðŸŒŒ CELESTIAL ENHANCED PGAT - ULTIMATE DEEP CONFIGURATION (FIXED)
# Heavy-duty overnight training with maximum model capacity
# FIXED: Dimensional compatibility issues resolved

# Core Model Architecture - ULTIMATE DEEP
activation: gelu
d_model: 780                    # Main model dimension
n_heads: 20                     # Attention heads (780 Ã· 20 = 39 per head)
d_ff: 3120                      # Feed-forward dimension (4 Ã— d_model)
e_layers: 12                    # Encoder layers (deep)
d_layers: 6                     # Decoder layers

# FIXED: Dimensional Compatibility
celestial_dim: 260              # FIXED: LCM(20,13) = 260 (divisible by both n_heads and num_celestial_bodies)
calendar_embedding_dim: 195     # FIXED: d_model Ã· 4 = 195 (optimal size)
num_celestial_bodies: 13        # Celestial bodies count

# Data Configuration
data: custom
data_name: custom
data_path: prepared_financial_data.csv
root_path: ./data
features: MS
target: log_Open,log_High,log_Low,log_Close
target_wave_indices: [0, 1, 2, 3]
freq: d
embed: timeF

# Sequence Configuration - ULTRA LONG TERM
seq_len: 500                    # Input sequence length
label_len: 250                  # Decoder label length
pred_len: 20                    # Prediction horizon
c_out: 4                        # Output features (OHLC)
enc_in: 118                     # Encoder input features
dec_in: 118                     # Decoder input features
num_input_waves: 118            # Total input waves

# Training Configuration
batch_size: 2                   # Small batch for memory efficiency
train_epochs: 75                # Full production training (restored from original)
learning_rate: 0.00008          # Conservative learning rate
weight_decay: 0.015             # Regularization
gradient_accumulation_steps: 3  # Effective batch size = 6

# ENHANCED: Mixture NLL Directional Loss (ACTIVATED)
loss:
  type: hybrid_mdn_directional  # Hybrid MDN + Directional loss
  nll_weight: 0.25              # MDN NLL component weight
  direction_weight: 4.0         # Directional accuracy weight
  trend_weight: 2.0             # Trend consistency weight
  magnitude_weight: 0.15        # Magnitude accuracy weight
  correlation_type: pearson     # Correlation type for trend

# MDN Configuration (ACTIVATED)
enable_mdn_decoder: true        # Enable MDN decoder
use_mixture_decoder: true       # Enable mixture decoder
use_sequential_mixture_decoder: true  # Enable sequential mixture
mdn_components: 8               # Number of mixture components
mdn_sigma_min: 0.001           # Minimum sigma
mdn_sigma_max: 1.0             # Maximum sigma
mdn_use_softplus: true         # Use softplus for sigma

# Advanced Features - ENABLED
use_efficient_covariate_interaction: true
use_celestial_graph: true
use_celestial_target_attention: true
use_calendar_effects: true
use_phase_aware_processing: true
use_hierarchical_mapping: true
use_multi_scale_context: true
use_dynamic_spatiotemporal_encoder: true
use_gated_graph_combiner: true
use_petri_net_combiner: true
use_spatial_attention: true
use_temporal_attention: true
use_target_autocorrelation: true
use_stochastic_learner: true
use_stochastic_control: true

# Celestial Configuration
aggregate_waves_to_celestial: true
celestial_fusion_layers: 6
use_future_celestial_conditioning: false

# Graph Configuration
num_message_passing_steps: 4
edge_feature_dim: 32

# Context Fusion
context_fusion_mode: multi_scale
context_fusion_layers: 3
context_fusion_dropout: 0.1

# Petri Net Configuration
bypass_spatiotemporal_with_petri: true
petri_net_places: 39
petri_net_transitions: 52

# Hierarchical Configuration
hierarchical_levels: 5
hierarchical_reduction_factor: 2

# Stochastic Configuration
stochastic_layers: 4
stochastic_temperature_start: 3.0
stochastic_temperature_end: 0.05
stochastic_decay_steps: 3000

# Kernel Sizes
short_term_kernel_size: 5
medium_term_kernel_size: 25
long_term_kernel_size: 125

# Regularization
dropout: 0.1
use_dropout_schedule: true
dropout_schedule_start: 0.15
dropout_schedule_end: 0.05
clip_grad_norm: 0.8
reg_loss_weight: 0.002
label_smoothing: 0.05

# Learning Rate Schedule
lradj: warmup_cosine
warmup_epochs: 8
min_lr: 0.000000005
cosine_restarts: 2

# Optimization
use_lookahead_optimizer: false
lookahead_k: 5
lookahead_alpha: 0.5
ema_decay: 0.9999

# Normalization
use_layer_norm: true
use_batch_norm: false
use_spectral_norm: true
scale: true

# Advanced Training Features
mixed_precision: false
use_amp: false
deterministic: true
use_curriculum_learning: false
curriculum_start_seq_len: 100
curriculum_end_seq_len: 500
curriculum_steps: 10

# Ensemble Configuration
use_ensemble_prediction: false
ensemble_size: 3
ensemble_method: weighted_average

# Progressive Growing
use_progressive_growing: false

# Knowledge Distillation
use_knowledge_distillation: false

# Multi-GPU
use_multi_gpu: false

# Calibration Metrics
calibration_metrics:
  compute_crps: true
  compute_energy_score: true
  compute_variogram_score: true
  crps_samples: 300
  coverage_levels: [0.5, 0.68, 0.8, 0.9, 0.95, 0.99]

# Adversarial Testing
enable_adversarial_checks: true
adversarial_noise_std: 0.08
adversarial_scale_factor: 0.25
adversarial_dropout_ratio: 0.12
adversarial_max_batches: 12

# System Configuration
use_gpu: true
gpu: 0
devices: '0'
num_workers: 0
pin_memory: true
persistent_workers: false
prefetch_factor: 2

# Memory Management
max_memory_usage: 0.85
enable_memory_diagnostics: false
enable_memory_snapshots: true
memory_log_interval: 100
memory_snapshot_interval: 100
memory_summary_on_exception: true
dump_cuda_memory_summary: false

# Checkpointing
checkpoints: ./checkpoints/
save_checkpoints: true
save_best_only: false
checkpoint_interval: 3

# Early Stopping
patience: 25
early_stopping_patience: 30
early_stopping_min_delta: 0.000001
early_stopping_restore_best_weights: true

# Logging
log_level: INFO
log_format: '%(asctime)s | %(levelname)-8s | %(name)s | %(message)s'
log_file: logs/production_ultimate_deep_training_fixed.log
log_interval: 10                # Show batch progress every 10 batches
verbose_logging: false
debug_mode: true
debug_log_file: logs/debug_training_fixed.log

# Diagnostics
collect_diagnostics: false
log_gradient_norms: false
log_weight_norms: false

# Tracking
track_training_time: true
track_memory_usage: true
track_gpu_utilization: true
track_learning_rate: true
track_loss_components: true

# Seeds
seed: 42
random_seed: 42
production_seed: 42

# Task Configuration
task_name: ultra_long_term_forecast
model: Celestial_Enhanced_PGAT
model_name: Celestial_Enhanced_PGAT
model_id: celestial_ultimate_deep_500x20_fixed

# Legacy Compatibility
inverse: false
cols: null
itr: 1
train_only: false
do_predict: false
output_attention: false
factor: 1
distil: true
mix: true
seasonal_patterns: Monthly

# Validation/Test Configuration
validation_length: 100
test_length: 100